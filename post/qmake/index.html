<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.41" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Qt .pro 文件(qmake) 入门和常用功能 | K.Y</title>
    <meta property="og:title" content="Qt .pro 文件(qmake) 入门和常用功能 - K.Y">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content="2018-11-19T21:42:52&#43;08:00">
        
        
    <meta property="article:modified_time" content="2018-11-19T21:42:52&#43;08:00">
        
    <meta name="Keywords" content="golang,typescript,electron,c&#43;&#43;,javascript">
    <meta name="description" content="Qt .pro 文件(qmake) 入门和常用功能">
        
    <meta name="author" content="ttchengcheng">
    <meta property="og:url" content="https://ttchengcheng.github.io/blog/post/qmake/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href="/blog/css/normalize.css">
    
        <link rel="stylesheet" href="/blog/css/prism.css">
    
    <link rel="stylesheet" href="/blog/css/style.css">
    <script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>

    


    
    
</head>

<body>
<header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://ttchengcheng.github.io/blog">
                        K.Y
                    </a>
                
                <p class="description">dev &amp; share</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://ttchengcheng.github.io/blog">首页</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>


<div id="body">
    <div class="container">
        <div class="col-group">

            <div class="col-8" id="main">
                <div class="res-cons">
                    <article class="post">
                        <header>
                            <h1 class="post-title">Qt .pro 文件(qmake) 入门和常用功能</h1>
                        </header>
                        <date class="post-meta meta-date">
                            2018年11月19日
                        </date>
                        
                        <div class="post-meta meta-category">
                            |
                            
                                <a href="https://ttchengcheng.github.io/categories/qt">Qt</a>
                            
                        </div>
                        
                        
                        <div class="post-content">
                            

<h1 id="qt-pro-文件-qmake-入门和常用功能">Qt <code>.pro</code> 文件(<code>qmake</code>) 入门和常用功能</h1>

<h2 id="简介">简介</h2>

<p>Qt 的工程是这样一个流程：</p>

<ul>
<li>创建一个 <code>pro</code> 文件，使用 <code>qmake</code> 语法描述工程设置</li>
<li>运行 <code>qmake</code> 命令，这个命令的作用是把 <code>pro</code> 文件转换成一个 <code>Makefile</code> 文件</li>
<li>运行 <code>make</code> 命令，会用生成好的 <code>Makefile</code> 进行编译</li>
</ul>

<p>可以在 Qt creator 的项目页面查看并编辑:</p>

<pre><code class="language-sh">qmake /Users/***/git/myProject/myProject.pro -spec macx-clang CONFIG+=debug CONFIG+=x86_64 &amp;&amp; /Library/Developer/CommandLineTools/usr/bin/make qmake_all
</code></pre>

<h2 id="qmake-的作用">qmake 的作用</h2>

<ul>
<li>生成 Makefile</li>
</ul>

<pre><code class="language-sh">  qmake -makefile
</code></pre>

<ul>
<li>生成工程文件 (.pro)</li>
</ul>

<pre><code class="language-sh">  qmake -project
</code></pre>

<ul>
<li>对 Qt 特殊机制的支持，自动加入构建 <a href="http://doc.qt.io/qt-5/moc.html">moc</a> 和<a href="http://doc.qt.io/qt-5/uic.html">uic</a>的构建规则</li>
<li>可以生成 Microsoft Visual studio / XCode 工程文件
<a href="http://doc.qt.io/qt-5/qmake-platform-notes.html">参考: Platform Notes | qmake Manual</a></li>
</ul>

<pre><code class="language-sh">  # xcode
  qmake xx.pro -spec macx-xcode

  # vs project
  set QMAKESPEC=win32-msvc2008 # if needed
  qmake -tp vc mainprojectfile.pro

  # vs solution
  qmake -tp vc -r mainprojectfile.pro
</code></pre>

<h2 id="基本语法">基本语法</h2>

<p>很简单不细说</p>

<ul>
<li><a href="http://doc.qt.io/qt-5/qmake-language.html">qmake Language | qmake Manual</a></li>
<li><a href="http://doc.qt.io/qt-5/qmake-project-files.html">Creating Project Files | qmake Manual</a></li>
</ul>

<h2 id="常见功能用法">常见功能用法</h2>

<h3 id="设定编译目标名称">设定编译目标名称</h3>

<p>默认名称为 <code>pro</code> 文件的名字，假如是一个 <code>exe</code> 工程，工程文件是 <code>hello.pro</code>，则默认编译为 <code>hello.exe</code>
可以用 <code>TARGET</code> 变量来指定名字.
目标文件名的后缀会根据目标操作系统自动添加</p>

<pre><code class="language-qmake">TARGET = helloworld
</code></pre>

<h3 id="debug-release-分支">debug|release 分支</h3>

<pre><code class="language-qmake">CONFIG(release, debug|release): message(&quot;build on release mode&quot;)
CONFIG(debug, debug|release): message(&quot;build on debug mode&quot;)
</code></pre>

<h3 id="多条件">多条件</h3>

<pre><code class="language-qmake">win32 {
    debug {
        CONFIG += console
    }
}

# 或者
win32:debug {
    CONFIG += console
}
</code></pre>

<h3 id="设置应用程序图标">设置应用程序图标</h3>

<p><a href="http://doc.qt.io/archives/qt-4.8/appicon.html">参考: Setting the Application Icon | Qt 4.8</a></p>

<pre><code class="language-qmake">win32:RC_FILE += $${PWD}/src/resource/icon/appico.rc
macx:ICON = $${PWD}/src/resource/icon/appico.icns
</code></pre>

<h3 id="使用预编译头文件">使用预编译头文件</h3>

<blockquote>
<p>预编译头文件将一些项目中普遍使用的头文件内容的词法分析、语法分析等结果缓存在一个特定格式的二进制文件中
当然编译实质 <code>C</code>/<code>C++</code> 源文件时，就不必从头对这些头文件进行词法语法分析，而只需要利用那些已经完成词法 - 语法分析的结果就可以了。
对于大工程, 把基本上不变的内容放到预编译头文件，可以显著减少编译时间</p>
</blockquote>

<pre><code class="language-qmake">PRECOMPILED_HEADER = aaa.h
</code></pre>

<pre><code class="language-cpp">/* aaa.h */

#ifdef __cplusplus
/* Add C++ includes here */

#include &lt;QRect&gt;
#include &lt;QString&gt;
#endif
</code></pre>

<h3 id="添加宏定义">添加宏定义</h3>

<pre><code class="language-qmake">DEFINES += MY_DEBUG
DEFINES += MY_LOG_LEVEL=3
</code></pre>

<h3 id="添加-framework-依赖">添加 framework 依赖</h3>

<p><a href="https://stackoverflow.com/questions/3513907/linking-mac-framework-to-qt-creator">参考: linking mac framework to qt creator</a></p>

<pre><code class="language-qmake">QMAKE_LFLAGS += -F/path/to/framework/directory/
LIBS += -framework TheFramework
</code></pre>

<h3 id="添加-lib-dll-dylib">添加 <code>lib</code>/<code>dll</code>/<code>dylib</code></h3>

<p><a href="http://doc.qt.io/qt-5/third-party-libraries.html">参考: Third Party Libraries | Qt 5.10</a>
<a href="https://wiki.qt.io/How_to_link_to_a_dll">参考: How to link to a dll - Qt Wiki</a></p>

<p>以 <code>protobuf-lite</code> 为例</p>

<pre><code class="language-qmake">macx {
  LIB_PROTOBUF=&quot;$$_PRO_FILE_PWD_/libs/libprotobuf-lite.a&quot;
  !exists($$LIB_PROTOBUF): error (&quot;Not existing $$LIB_PROTOBUF&quot;)
  LIBS+= $$LIB_PROTOBUF
}
win32 {
  CONFIG(release, debug|release): LIB_PROTOBUF=&quot;$$_PRO_FILE_PWD_\libs\libprotobuf-lite.lib&quot;
  CONFIG(debug, debug|release): LIB_PROTOBUF=&quot;$$_PRO_FILE_PWD_\libs\libprotobuf-lite-debug.lib&quot;

  !exists($$LIB_PROTOBUF): error (&quot;Not existing $$LIB_PROTOBUF&quot;)
  LIBS+= $$LIB_PROTOBUF
}
</code></pre>

<h3 id="添加对-c-新标准的支持">添加对 C++ 新标准的支持</h3>

<p>添加 C++14 支持, C++<sup>11</sup>&frasl;<sub>17</sub> 同理 (注意: 需要编译器支持才能真正生效！)</p>

<pre><code class="language-qmake">CONFIG += c++14
</code></pre>

<h3 id="编译前-后执行自定义命令">编译前 / 后执行自定义命令</h3>

<pre><code class="language-qmake"># 编译前执行 (例子里是拷贝命令)
QMAKE_PRE_LINK = cp - f [source] [destionation]

# 编译后执行 (例子里是拷贝命令)
QMAKE_POST_LINK = cp - f [source] [destination]
</code></pre>

<h3 id="自动编译-ts-文件为-qm-文件">自动编译 ts 文件为 qm 文件</h3>

<p>需要 lrelease 文件的目录已经加进了系统 PATH，而且需要有实际的编译动作才会执行。</p>

<pre><code class="language-qmake"># (caution1: this requires dir of lrelease is in PATH)
# (caution2: this only run when there is something to compile, or this step will be omitted)
QMAKE_PRE_LINK += lrelease $$_PRO_FILE_
</code></pre>

<h3 id="执行-qmake-时执行一个-shell-命令">执行 qmake 时执行一个 shell 命令</h3>

<pre><code class="language-qmake">system(&quot;lrelease&quot;$$_PRO_FILE_)
</code></pre>

<h3 id="编译完成后拷贝一些文件到指定目录">编译完成后拷贝一些文件到指定目录</h3>

<p><code>$${QMAKE_COPY_DIR}</code> 是一个平台无关的目录拷贝命令
<code>$${QMAKE_COPY}</code> 是一个平台无关的文件拷贝命令
<code>$${OUT_PWD}</code> 是编译输出目录</p>

<pre><code class="language-qmake">QMAKE_POST_LINK += $${QMAKE_COPY_DIR} $${_PRO_FILE_PWD_}/doc/* $${OUT_PWD}/../otherdoc
</code></pre>

<p>多个命令可以用分号隔开</p>

<pre><code class="language-qmake">QMAKE_POST_LINK += $${QMAKE_COPY_DIR} $${_PRO_FILE_PWD_}/util/* $${_PRO_FILE_PWD_}/../other; \
    $${QMAKE_COPY_DIR} $${_PRO_FILE_PWD_}/data/* $${_PRO_FILE_PWD_}/../other
</code></pre>

<p>类似的命令: <a href="https://stackoverflow.com/questions/20324061/where-are-variables-such-as-mkdir-and-copy-dir-defined">参考</a></p>

<pre><code class="language-qmake">QMAKE_TAR               = tar -cf
QMAKE_GZIP              = gzip -9f

QMAKE_CD                = cd
QMAKE_COPY              = cp -f
QMAKE_COPY_FILE         = $$QMAKE_COPY
QMAKE_COPY_DIR          = $$QMAKE_COPY -R
QMAKE_MOVE              = mv -f
QMAKE_DEL_FILE          = rm -f
QMAKE_DEL_DIR           = rmdir
QMAKE_DEL_TREE          = rm -rf
QMAKE_CHK_EXISTS        = test -e %1 ||
QMAKE_CHK_DIR_EXISTS    = test -d    # legacy
QMAKE_MKDIR             = mkdir -p   # legacy
QMAKE_MKDIR_CMD         = test -d %1 || mkdir -p %1
QMAKE_STREAM_EDITOR     = sed
</code></pre>

<h3 id="把文件打包进-mac-版本的-xx-app">把文件打包进 mac 版本的 xx.app</h3>

<pre><code class="language-qmake">macx{
    MACX_RESOURCES.files = translations/test_zh.qm
    MACX_RESOURCES.path = Contents/Resources
    QMAKE_BUNDLE_DATA += MACX_RESOURCES
}
</code></pre>

<h3 id="编译完成后拷贝-文件的另一种方法-不推荐">编译完成后拷贝文件的另一种方法 (不推荐)</h3>

<pre><code class="language-qmake">config.path    = $${DESTDIR}/config
config.files   = config/*
INSTALLS       += config
</code></pre>

<h3 id="屏蔽编译警告-clang">屏蔽编译警告 (clang)</h3>

<p>先从输出面板看到编译警告信息 <code>xxx.cpp ...[Wunused-parameter]</code>, 然后在警告的大写 <code>W</code> 后面加个 <code>no-</code></p>

<pre><code class="language-qmake">contains(QMAKE_COMPILER, clang) {
    QMAKE_CXXFLAGS_WARN_ON += -Wno-unused-parameter \
        -Wno-unused-function \
        -Wno-inconsistent-missing-override \
        -Wno-reorder \
        -Wno-ignored-qualifiers \
        -Wno-undefined-var-template \
        -Wno-varargs
}
</code></pre>

<p>以上内容需要执行<code>make install</code> 才能起作用，而 Qt creator默认是执行 <code>make</code>
需要到项目页面，添加构建步骤 -&gt; Make -&gt; Make 参数: 设置为 <code>install</code></p>

<p>这些构建步骤保存在 xxx.pro.user 文件里 <a href="http://doc.qt.io/qtcreator/creator-sharing-project-settings.html">参考: Sharing Project Settings | Qt Creator Manual</a></p>

<h2 id="qt-构建系统的现状">Qt 构建系统的现状</h2>

<ul>
<li><a href="https://wiki.qt.io/Qt_build_systems_at_QtCon_2016">Qt build systems at QtCon 2016 - Qt Wiki</a></li>
</ul>

<h2 id="其他参考">其他参考</h2>

<ul>
<li><a href="http://doc.qt.io/qt-5/qmake-manual.html">qmake Manual</a></li>
<li><a href="http://doc.qt.io/qt-5/windows-deployment.html">Qt for Windows - Deployment | Qt 5.10</a></li>
<li><a href="http://doc.qt.io/qt-5/osx-deployment.html">Qt for macOS - Deployment | Qt 5.10</a></li>
</ul>

                        </div>

                        


                        <div class="post-meta meta-tags">
                            
                            <ul class="clearfix">
                                
                                <li><a href="https://ttchengcheng.github.io/tags/qt">Qt</a></li>
                                
                                <li><a href="https://ttchengcheng.github.io/tags/qmake">qmake</a></li>
                                
                                <li><a href="https://ttchengcheng.github.io/tags/pro">pro</a></li>
                                
                                <li><a href="https://ttchengcheng.github.io/tags/makefile">Makefile</a></li>
                                
                            </ul>
                            
                        </div>
                    </article>
                    
    

    
    
                </div>
            </div>
            <div id="secondary">
    <section class="widget">
        <form id="search" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://ttchengcheng.github.io/blog">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://ttchengcheng.github.io/blog/post/electron-single-instance/" title="Electron 单实例应用程序实现要点">Electron 单实例应用程序实现要点</a>
    </li>
    
    <li>
        <a href="https://ttchengcheng.github.io/blog/post/qmake/" title="Qt .pro 文件(qmake) 入门和常用功能">Qt .pro 文件(qmake) 入门和常用功能</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">分类</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://ttchengcheng.github.io/categories/electron/">electron(1)</a>
    </li>
    
    <li>
        <a href="https://ttchengcheng.github.io/categories/qt/">qt(1)</a>
    </li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">标签</h3>
<div class="tagcloud">
    
    <a href="https://ttchengcheng.github.io/tags/electron/">electron</a>
    
    <a href="https://ttchengcheng.github.io/tags/macos/">macos</a>
    
    <a href="https://ttchengcheng.github.io/tags/makefile/">makefile</a>
    
    <a href="https://ttchengcheng.github.io/tags/pro/">pro</a>
    
    <a href="https://ttchengcheng.github.io/tags/qmake/">qmake</a>
    
    <a href="https://ttchengcheng.github.io/tags/qt/">qt</a>
    
    <a href="https://ttchengcheng.github.io/tags/typescript/">typescript</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://ttchengcheng.github.io/blog/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
        </div>
    </div>
</div>
<footer id="footer">
    <div class="container">
        &copy; 2018 <a href="https://ttchengcheng.github.io/blog">K.Y By ttchengcheng</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>.
        <a href="http://www.flysnow.org/" target="_blank">Theme</a> based on <a href="https://github.com/rujews/maupassant-hugo" target="_blank">maupassant</a>.
        
    </div>
</footer>


    <script type="text/javascript" src="/blog/js/prism.js" async="true"></script>
    <script type="text/javascript">
    window.MathJax = {
        tex2jax: {
            inlineMath: [ ['$','$'] ],
            processEscapes: true
        }
    };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src="/blog/js/totop.js?v=0.0.0" async=""></script>






</body>
</html>
